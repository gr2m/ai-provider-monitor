{
  "operationId": "createEvaluationJob",
  "requestBody": {
    "content": {
      "application/json": {
        "schema": {
          "$ref": "#/components/schemas/EvaluationTypedRequest"
        }
      }
    },
    "required": true
  },
  "responses": {
    "200": {
      "content": {
        "application/json": {
          "schema": {
            "$ref": "#/components/schemas/EvaluationResponse"
          }
        }
      },
      "description": "Evaluation job created successfully"
    },
    "400": {
      "content": {
        "application/json": {
          "schema": {
            "$ref": "#/components/schemas/ErrorData"
          }
        }
      },
      "description": "Invalid request format"
    },
    "500": {
      "content": {
        "application/json": {
          "schema": {
            "$ref": "#/components/schemas/ErrorData"
          }
        }
      },
      "description": "Failed to create evaluation job"
    }
  },
  "summary": "Create an evaluation job",
  "tags": [
    "evaluation"
  ],
  "components": {
    "schemas": {
      "EvaluationTypedRequest": {
        "properties": {
          "parameters": {
            "description": "Type-specific parameters for the evaluation",
            "oneOf": [
              {
                "$ref": "#/components/schemas/EvaluationClassifyParameters"
              },
              {
                "$ref": "#/components/schemas/EvaluationScoreParameters"
              },
              {
                "$ref": "#/components/schemas/EvaluationCompareParameters"
              }
            ]
          },
          "type": {
            "description": "The type of evaluation to perform",
            "enum": [
              "classify",
              "score",
              "compare"
            ],
            "example": "classify",
            "type": "string"
          }
        },
        "required": [
          "type",
          "parameters"
        ],
        "type": "object"
      },
      "EvaluationResponse": {
        "properties": {
          "status": {
            "description": "Initial status of the job",
            "enum": [
              "pending"
            ],
            "type": "string"
          },
          "workflow_id": {
            "description": "The ID of the created evaluation job",
            "example": "eval-1234-1244513",
            "type": "string"
          }
        },
        "type": "object"
      },
      "ErrorData": {
        "properties": {
          "error": {
            "properties": {
              "code": {
                "default": null,
                "nullable": true,
                "type": "string"
              },
              "message": {
                "nullable": false,
                "type": "string"
              },
              "param": {
                "default": null,
                "nullable": true,
                "type": "string"
              },
              "type": {
                "nullable": false,
                "type": "string"
              }
            },
            "required": [
              "type",
              "message"
            ],
            "type": "object"
          }
        },
        "required": [
          "error"
        ],
        "type": "object"
      },
      "EvaluationClassifyParameters": {
        "properties": {
          "input_data_file_path": {
            "description": "Data file ID",
            "example": "file-1234-aefd",
            "type": "string"
          },
          "judge": {
            "$ref": "#/components/schemas/EvaluationJudgeModelConfig"
          },
          "labels": {
            "description": "List of possible classification labels",
            "example": [
              "yes",
              "no"
            ],
            "items": {
              "type": "string"
            },
            "minItems": 2,
            "type": "array"
          },
          "model_to_evaluate": {
            "$ref": "#/components/schemas/EvaluationModelOrString"
          },
          "pass_labels": {
            "description": "List of labels that are considered passing",
            "example": [
              "yes"
            ],
            "items": {
              "type": "string"
            },
            "minItems": 1,
            "type": "array"
          }
        },
        "required": [
          "judge",
          "labels",
          "pass_labels",
          "input_data_file_path"
        ],
        "type": "object"
      },
      "EvaluationScoreParameters": {
        "properties": {
          "input_data_file_path": {
            "description": "Data file ID",
            "example": "file-01234567890123456789",
            "type": "string"
          },
          "judge": {
            "$ref": "#/components/schemas/EvaluationJudgeModelConfig"
          },
          "max_score": {
            "description": "Maximum possible score",
            "example": 10,
            "format": "float",
            "type": "number"
          },
          "min_score": {
            "description": "Minimum possible score",
            "example": 0,
            "format": "float",
            "type": "number"
          },
          "model_to_evaluate": {
            "$ref": "#/components/schemas/EvaluationModelOrString"
          },
          "pass_threshold": {
            "description": "Score threshold for passing",
            "example": 7,
            "format": "float",
            "type": "number"
          }
        },
        "required": [
          "judge",
          "min_score",
          "max_score",
          "pass_threshold",
          "input_data_file_path"
        ],
        "type": "object"
      },
      "EvaluationCompareParameters": {
        "properties": {
          "input_data_file_path": {
            "description": "Data file name",
            "type": "string"
          },
          "judge": {
            "$ref": "#/components/schemas/EvaluationJudgeModelConfig"
          },
          "model_a": {
            "$ref": "#/components/schemas/EvaluationModelOrString"
          },
          "model_b": {
            "$ref": "#/components/schemas/EvaluationModelOrString"
          }
        },
        "required": [
          "judge",
          "input_data_file_path"
        ],
        "type": "object"
      },
      "EvaluationJudgeModelConfig": {
        "properties": {
          "external_api_token": {
            "description": "Bearer/API token for external judge models.",
            "type": "string"
          },
          "external_base_url": {
            "description": "Base URL for external judge models. Must be OpenAI-compatible base URL.",
            "type": "string"
          },
          "model": {
            "description": "Name of the judge model",
            "example": "meta-llama/Llama-3-70B-Instruct-Turbo",
            "type": "string"
          },
          "model_source": {
            "description": "Source of the judge model.",
            "enum": [
              "serverless",
              "dedicated",
              "external"
            ],
            "type": "string"
          },
          "system_template": {
            "description": "System prompt template for the judge",
            "example": "Imagine you are a helpful assistant",
            "type": "string"
          }
        },
        "required": [
          "model",
          "system_template",
          "model_source"
        ],
        "type": "object"
      },
      "EvaluationModelOrString": {
        "oneOf": [
          {
            "description": "Field name in the input data",
            "type": "string"
          },
          {
            "$ref": "#/components/schemas/EvaluationModelRequest"
          }
        ]
      },
      "EvaluationModelRequest": {
        "properties": {
          "external_api_token": {
            "description": "Bearer/API token for external models.",
            "type": "string"
          },
          "external_base_url": {
            "description": "Base URL for external models. Must be OpenAI-compatible base URL",
            "type": "string"
          },
          "input_template": {
            "description": "Input prompt template",
            "example": "Please classify {{prompt}} based on the labels below",
            "type": "string"
          },
          "max_tokens": {
            "description": "Maximum number of tokens to generate",
            "example": 512,
            "minimum": 1,
            "type": "integer"
          },
          "model": {
            "description": "Name of the model to evaluate",
            "example": "meta-llama/Llama-3-70B-Instruct-Turbo",
            "type": "string"
          },
          "model_source": {
            "description": "Source of the model.",
            "enum": [
              "serverless",
              "dedicated",
              "external"
            ],
            "type": "string"
          },
          "system_template": {
            "description": "System prompt template",
            "example": "Imagine you are helpful assistant",
            "type": "string"
          },
          "temperature": {
            "description": "Sampling temperature",
            "example": 0.7,
            "format": "float",
            "maximum": 2,
            "minimum": 0,
            "type": "number"
          }
        },
        "required": [
          "model",
          "max_tokens",
          "temperature",
          "system_template",
          "input_template",
          "model_source"
        ],
        "type": "object"
      }
    }
  }
}
