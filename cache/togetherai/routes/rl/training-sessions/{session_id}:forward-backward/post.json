{
  "description": "Submits a forward-backward pass operation that will asynchronously compute gradients via backpropagation.",
  "operationId": "forwardBackward",
  "parameters": [
    {
      "description": "Training session ID",
      "in": "path",
      "name": "session_id",
      "required": true,
      "schema": {
        "type": "string"
      }
    }
  ],
  "requestBody": {
    "content": {
      "application/json": {
        "schema": {
          "properties": {
            "loss": {
              "description": "Loss function configuration",
              "properties": {
                "cross_entropy_params": {
                  "description": "Cross-entropy loss parameters (currently empty).",
                  "properties": {},
                  "type": "object"
                },
                "grpo_params": {
                  "properties": {
                    "agg_type": {
                      "description": "Aggregation type for loss computation",
                      "example": "fixed_horizon",
                      "type": "string"
                    },
                    "beta": {
                      "description": "KL penalty coefficient",
                      "example": 0.1,
                      "type": "number"
                    },
                    "clip_high": {
                      "description": "Upper clip bound for importance ratio",
                      "example": 0.28,
                      "type": "number"
                    },
                    "clip_low": {
                      "description": "Lower clip bound for importance ratio",
                      "example": 0.2,
                      "type": "number"
                    }
                  },
                  "type": "object"
                },
                "type": {
                  "description": "Type of loss function to use",
                  "example": "LOSS_TYPE_GRPO",
                  "default": "LOSS_TYPE_UNSPECIFIED",
                  "enum": [
                    "LOSS_TYPE_UNSPECIFIED",
                    "LOSS_TYPE_CROSS_ENTROPY",
                    "LOSS_TYPE_GRPO"
                  ],
                  "type": "string"
                }
              },
              "required": [
                "type"
              ],
              "type": "object"
            },
            "samples": {
              "description": "Batch of training samples to process",
              "items": {
                "type": "object",
                "properties": {
                  "loss_inputs": {
                    "description": "Loss function inputs",
                    "properties": {
                      "grpo_inputs": {
                        "properties": {
                          "advantages": {
                            "description": "Per-token advantages for GRPO",
                            "properties": {
                              "data": {
                                "description": "Float array of per-token advantages",
                                "example": [
                                  0.5,
                                  0.5
                                ],
                                "items": {
                                  "type": "number"
                                },
                                "type": "array"
                              },
                              "dtype": {
                                "description": "Data type of the float array (D_TYPE_FLOAT32 or D_TYPE_BFLOAT16)",
                                "example": "D_TYPE_FLOAT32",
                                "default": "D_TYPE_UNSPECIFIED",
                                "enum": [
                                  "D_TYPE_UNSPECIFIED",
                                  "D_TYPE_INT64",
                                  "D_TYPE_FLOAT32",
                                  "D_TYPE_BFLOAT16"
                                ],
                                "type": "string"
                              }
                            },
                            "required": [
                              "data"
                            ],
                            "type": "object"
                          },
                          "generator_logprobs": {
                            "description": "Generator log probabilities for GRPO",
                            "properties": {
                              "data": {
                                "description": "Float array of per-token log probabilities",
                                "example": [
                                  -1.2,
                                  -0.8
                                ],
                                "items": {
                                  "type": "number"
                                },
                                "type": "array"
                              },
                              "dtype": {
                                "description": "Data type of the float array (D_TYPE_FLOAT32 or D_TYPE_BFLOAT16)",
                                "example": "D_TYPE_FLOAT32",
                                "default": "D_TYPE_UNSPECIFIED",
                                "enum": [
                                  "D_TYPE_UNSPECIFIED",
                                  "D_TYPE_INT64",
                                  "D_TYPE_FLOAT32",
                                  "D_TYPE_BFLOAT16"
                                ],
                                "type": "string"
                              }
                            },
                            "required": [
                              "data"
                            ],
                            "type": "object"
                          },
                          "reference_logprobs": {
                            "description": "Reference model log probabilities (required if beta > 0)",
                            "properties": {
                              "data": {
                                "description": "Float array of per-token log probabilities",
                                "example": [
                                  -1.2,
                                  -0.8
                                ],
                                "items": {
                                  "type": "number"
                                },
                                "type": "array"
                              },
                              "dtype": {
                                "description": "Data type of the float array (D_TYPE_FLOAT32 or D_TYPE_BFLOAT16)",
                                "example": "D_TYPE_FLOAT32",
                                "default": "D_TYPE_UNSPECIFIED",
                                "enum": [
                                  "D_TYPE_UNSPECIFIED",
                                  "D_TYPE_INT64",
                                  "D_TYPE_FLOAT32",
                                  "D_TYPE_BFLOAT16"
                                ],
                                "type": "string"
                              }
                            },
                            "required": [
                              "data"
                            ],
                            "type": "object"
                          }
                        },
                        "required": [
                          "advantages",
                          "generator_logprobs"
                        ],
                        "type": "object"
                      },
                      "loss_mask": {
                        "description": "Per-token loss mask (1=compute loss, 0=ignore)",
                        "properties": {
                          "data": {
                            "description": "Integer array of per-token mask values (0s and 1s)",
                            "example": [
                              0,
                              0,
                              1
                            ],
                            "items": {
                              "type": "integer"
                            },
                            "type": "array"
                          },
                          "dtype": {
                            "description": "Data type of the integer array (must be D_TYPE_INT64)",
                            "example": "D_TYPE_INT64",
                            "default": "D_TYPE_UNSPECIFIED",
                            "enum": [
                              "D_TYPE_UNSPECIFIED",
                              "D_TYPE_INT64",
                              "D_TYPE_FLOAT32",
                              "D_TYPE_BFLOAT16"
                            ],
                            "type": "string"
                          }
                        },
                        "required": [
                          "data"
                        ],
                        "type": "object"
                      },
                      "target_tokens": {
                        "description": "Target tokens for loss computation (optional, defaults to shifted input_ids)",
                        "properties": {
                          "data": {
                            "description": "Integer array of target tokens",
                            "example": [
                              123,
                              456,
                              789
                            ],
                            "items": {
                              "type": "integer"
                            },
                            "type": "array"
                          },
                          "dtype": {
                            "description": "Data type of the integer array",
                            "example": "D_TYPE_INT64",
                            "default": "D_TYPE_UNSPECIFIED",
                            "enum": [
                              "D_TYPE_UNSPECIFIED",
                              "D_TYPE_INT64",
                              "D_TYPE_FLOAT32",
                              "D_TYPE_BFLOAT16"
                            ],
                            "type": "string"
                          }
                        },
                        "required": [
                          "data"
                        ],
                        "type": "object"
                      }
                    },
                    "type": "object"
                  },
                  "model_input": {
                    "description": "Model input",
                    "properties": {
                      "chunks": {
                        "description": "Input chunks for the model",
                        "items": {
                          "type": "object",
                          "properties": {
                            "encoded_text": {
                              "properties": {
                                "tokens": {
                                  "description": "Pre-tokenized text input",
                                  "example": [
                                    123,
                                    456,
                                    789
                                  ],
                                  "items": {
                                    "type": "integer"
                                  },
                                  "type": "array"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "type": "array"
                      }
                    },
                    "required": [
                      "chunks"
                    ],
                    "type": "object"
                  }
                },
                "required": [
                  "model_input",
                  "loss_inputs"
                ]
              },
              "type": "array"
            }
          },
          "required": [
            "samples",
            "loss"
          ],
          "type": "object"
        }
      }
    },
    "required": true
  },
  "responses": {
    "200": {
      "content": {
        "application/json": {
          "schema": {
            "properties": {
              "data": {
                "properties": {
                  "loss": {
                    "description": "Loss value",
                    "example": 2.345,
                    "type": "number"
                  },
                  "metrics": {
                    "additionalProperties": {
                      "type": "number"
                    },
                    "description": "Loss-specific metrics (e.g., KL divergence, clip fraction for GRPO)",
                    "type": "object"
                  }
                },
                "type": "object"
              },
              "error": {
                "properties": {
                  "code": {
                    "description": "Application error code",
                    "example": "OPERATION_TIMEOUT",
                    "type": "string"
                  },
                  "message": {
                    "description": "Human-readable error message",
                    "example": "Operation timed out",
                    "type": "string"
                  }
                },
                "type": "object"
              },
              "operation_id": {
                "description": "Operation ID",
                "type": "string"
              },
              "status": {
                "description": "Operation status",
                "example": "TRAINING_OPERATION_STATUS_PENDING",
                "default": "TRAINING_OPERATION_STATUS_UNSPECIFIED",
                "enum": [
                  "TRAINING_OPERATION_STATUS_UNSPECIFIED",
                  "TRAINING_OPERATION_STATUS_PENDING",
                  "TRAINING_OPERATION_STATUS_RUNNING",
                  "TRAINING_OPERATION_STATUS_COMPLETED",
                  "TRAINING_OPERATION_STATUS_FAILED"
                ],
                "type": "string"
              }
            },
            "type": "object"
          }
        }
      },
      "description": ""
    },
    "default": {
      "content": {
        "application/json": {
          "schema": {
            "properties": {
              "code": {
                "type": "integer"
              },
              "message": {
                "type": "string"
              }
            },
            "type": "object"
          }
        }
      },
      "description": "An unexpected error response."
    }
  },
  "summary": "Forward-backward pass",
  "tags": [
    "RL"
  ]
}
