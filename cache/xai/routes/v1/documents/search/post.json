{
  "operationId": "handle_document_search_request_v2",
  "requestBody": {
    "content": {
      "application/json": {
        "example": {
          "filter": "document_type = \"financial_report\" AND year > 2020",
          "query": "What is the revenue in the last quarter?",
          "source": {
            "collection_ids": [
              "collection_80100614-300c-4609-959b-a138fa90f542"
            ]
          }
        },
        "schema": {
          "description": "SearchRequest defines the request to search for documents.",
          "properties": {
            "filter": {
              "description": "Optional metadata filter string to apply to search results.\nUses AIP-160 filter syntax for querying document metadata.\nSupports comparison operators: `=`, `!=`, `>`, `>=`, `<`, `<=`\nSupports logical operators: `AND`, `OR`\nSupports range syntax: `field:10..20` (inclusive)\nExamples: `author = \"John\"` or `year > 2020 AND category = \"finance\"`",
              "type": [
                "string",
                "null"
              ]
            },
            "instructions": {
              "description": "User-defined instructions to be included in the search query. Defaults to generic search instructions.",
              "type": [
                "string",
                "null"
              ]
            },
            "limit": {
              "description": "The number of chunks to return.\nWill always return the top matching chunks.\nOptional, defaults to 10.",
              "format": "int32",
              "type": [
                "integer",
                "null"
              ]
            },
            "query": {
              "description": "The query to search for which will be embedded using the\nsame embedding model as the one used for the source to query.",
              "type": "string"
            },
            "ranking_metric": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Deprecated: Metric now comes from collection creation.",
                  "enum": [
                    "RANKING_METRIC_UNKNOWN",
                    "RANKING_METRIC_L2_DISTANCE",
                    "RANKING_METRIC_COSINE_SIMILARITY"
                  ],
                  "type": "string"
                }
              ]
            },
            "retrieval_mode": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "How to perform the document search. Defaults to hybrid retrieval.",
                  "oneOf": [
                    {
                      "allOf": [
                        {
                          "description": "Hybrid search combining keyword and semantic search.",
                          "properties": {
                            "reranker": {
                              "oneOf": [
                                {
                                  "type": "null"
                                },
                                {
                                  "description": "Which reranker to use to limit results to the desired value.",
                                  "oneOf": [
                                    {
                                      "allOf": [
                                        {
                                          "description": "Use a reranker model to perform the reranking.",
                                          "properties": {
                                            "instructions": {
                                              "description": "Instructions for the reranking model. Defaults to generic reranking instructions.",
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "model": {
                                              "description": "The model to use for reranking. Defaults to standard reranker model.",
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            }
                                          },
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "type": {
                                              "enum": [
                                                "reranker_model"
                                              ],
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type"
                                          ],
                                          "type": "object"
                                        }
                                      ],
                                      "description": "Use a reranker model to perform the reranking."
                                    },
                                    {
                                      "allOf": [
                                        {
                                          "description": "Use RRF to perform the reranking.",
                                          "properties": {
                                            "embedding_weight": {
                                              "description": "Weight for embedding (dense) search results. Should be between 0 and 1. Defaults to 0.5.",
                                              "format": "float",
                                              "type": "number"
                                            },
                                            "k": {
                                              "description": "The RRF constant k used in the reciprocal rank fusion formula. Defaults to 60.",
                                              "format": "int32",
                                              "type": [
                                                "integer",
                                                "null"
                                              ]
                                            },
                                            "text_weight": {
                                              "description": "Weight for keyword (sparse) search results. Should be between 0 and 1. Defaults to 0.5.",
                                              "format": "float",
                                              "type": "number"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "type": {
                                              "enum": [
                                                "rrf"
                                              ],
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type"
                                          ],
                                          "type": "object"
                                        }
                                      ],
                                      "description": "Use RRF to perform the reranking."
                                    }
                                  ]
                                }
                              ]
                            },
                            "search_multiplier": {
                              "description": "Additional multiplier to requested search limit.\nValid range is [1, 100]. Defaults to 1 when unset.",
                              "format": "int32",
                              "type": [
                                "integer",
                                "null"
                              ]
                            }
                          },
                          "type": "object"
                        },
                        {
                          "properties": {
                            "type": {
                              "enum": [
                                "hybrid"
                              ],
                              "type": "string"
                            }
                          },
                          "required": [
                            "type"
                          ],
                          "type": "object"
                        }
                      ],
                      "description": "Hybrid search combining keyword and semantic search."
                    },
                    {
                      "allOf": [
                        {
                          "description": "Semantic search using dense embeddings.",
                          "properties": {
                            "reranker": {
                              "oneOf": [
                                {
                                  "type": "null"
                                },
                                {
                                  "description": "Optional, but always used when doing search across multiple collections.",
                                  "properties": {
                                    "instructions": {
                                      "description": "Instructions for the reranking model. Defaults to generic reranking instructions.",
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "model": {
                                      "description": "The model to use for reranking. Defaults to standard reranker model.",
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    }
                                  },
                                  "type": "object"
                                }
                              ]
                            }
                          },
                          "type": "object"
                        },
                        {
                          "properties": {
                            "type": {
                              "enum": [
                                "semantic"
                              ],
                              "type": "string"
                            }
                          },
                          "required": [
                            "type"
                          ],
                          "type": "object"
                        }
                      ],
                      "description": "Semantic search using dense embeddings."
                    },
                    {
                      "allOf": [
                        {
                          "description": "Keyword search using sparse embeddings.",
                          "properties": {
                            "reranker": {
                              "oneOf": [
                                {
                                  "type": "null"
                                },
                                {
                                  "description": "Optional, but always used when doing search across multiple collections.",
                                  "properties": {
                                    "instructions": {
                                      "description": "Instructions for the reranking model. Defaults to generic reranking instructions.",
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "model": {
                                      "description": "The model to use for reranking. Defaults to standard reranker model.",
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    }
                                  },
                                  "type": "object"
                                }
                              ]
                            }
                          },
                          "type": "object"
                        },
                        {
                          "properties": {
                            "type": {
                              "enum": [
                                "keyword"
                              ],
                              "type": "string"
                            }
                          },
                          "required": [
                            "type"
                          ],
                          "type": "object"
                        }
                      ],
                      "description": "Keyword search using sparse embeddings."
                    }
                  ]
                }
              ]
            },
            "source": {
              "description": "The source to query.",
              "properties": {
                "collection_ids": {
                  "description": "The collection IDs to search in.",
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                }
              },
              "required": [
                "collection_ids"
              ],
              "type": "object"
            }
          },
          "required": [
            "query",
            "source"
          ],
          "type": "object"
        }
      }
    },
    "required": true
  },
  "responses": {
    "200": {
      "content": {
        "application/json": {
          "example": {
            "matches": [
              {
                "chunk_content": ", deferred revenue related to such customer payments amounted to $2.10 billion and $1.77 billion, respectively, mainly due to contractual payment terms. Revenue recognized from the deferred revenue balances as of December 31, 2024 and 2023 was $944 million and $873 million for the six months ended June 30, 2025 and 2024, respectively. We have elected the practical expedient to omit disclosure of the amount of the transaction price allocated to remaining performance obligations for contracts with an original expected contract length of one year or less. As of June 30, 2025, total transaction price allocated to performance obligations that were unsatisfied or partially unsatisfied for contracts with an original expected length of more than one year was $10.38 billion. Of this amount, we expect to recognize $5.47 billion in the next 12 months and the rest over the remaining performance obligation period. Changes in government and economic incentives or tariffs may impact the transaction price or our ability to e",
                "chunk_id": "0199717c-511b-7a80-bab3-dfe9a27f82ab",
                "collection_ids": [
                  "collection_80100614-300c-4609-959b-a138fa90f542"
                ],
                "file_id": "file_ac3c5728-7399-41fc-bd62-0fef0042de9c",
                "score": 1.1447691
              }
            ]
          },
          "schema": {
            "description": "SearchResponse defines the response to a search request.",
            "properties": {
              "matches": {
                "description": "The search matches.",
                "items": {
                  "description": "SearchMatch defines a single match from a search request.",
                  "properties": {
                    "chunk_content": {
                      "description": "The chunk content.",
                      "type": "string"
                    },
                    "chunk_id": {
                      "description": "The chunk ID.",
                      "type": "string"
                    },
                    "collection_ids": {
                      "description": "The collection ID(s).",
                      "items": {
                        "type": "string"
                      },
                      "type": "array"
                    },
                    "fields": {
                      "additionalProperties": {
                        "type": "string"
                      },
                      "description": "Metadata fields belonging to the document of this chunk.",
                      "propertyNames": {
                        "type": "string"
                      },
                      "type": "object"
                    },
                    "file_id": {
                      "description": "The document ID.",
                      "type": "string"
                    },
                    "score": {
                      "description": "The relevance score.",
                      "format": "float",
                      "type": "number"
                    }
                  },
                  "required": [
                    "file_id",
                    "chunk_id",
                    "chunk_content",
                    "score",
                    "collection_ids",
                    "fields"
                  ],
                  "type": "object"
                },
                "type": "array"
              }
            },
            "required": [
              "matches"
            ],
            "type": "object"
          }
        }
      },
      "description": "Success"
    },
    "400": {
      "description": "Bad request. The request is invalid or an invalid API key is provided."
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "summary": "Search for content related to the query within the given collections.",
  "tags": [
    "v1"
  ]
}
