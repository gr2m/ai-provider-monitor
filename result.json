{"has_changes":true,"first_run":false,"title":"update anthropic API specification (160 changes)","body":"### Breaking changes\n\n- **GET /v1/messages/batches/{message_batch_id}/results**: Added new response content block types: web_fetch_tool_result, code_execution_tool_result, bash_code_execution_tool_result, text_editor_code_execution_tool_result, tool_search_tool_result, container_upload.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Added new error code 'request_too_large' to web_search_tool_result error_code enum.\n- **GET /v1/skills?beta=true**: Removed beta List Skills endpoint that returned paginated skills with optional source filter.\n- **POST /v1/skills?beta=true**: Removed beta Create Skill endpoint POST /v1/skills?beta=true. It created a skill from uploaded files (multipart/form-data with files and optional display_title) and returned a skill object (id, display_title, source, latest_version, created_at, updated_at).\n- **DELETE /v1/skills/{skill_id}?beta=true**: DELETE /v1/skills/{skill_id}?beta=true removed. It deleted a skill by ID and returned a skill_deleted object with id and type.\n- **GET /v1/skills/{skill_id}?beta=true**: Beta GET endpoint to retrieve a skill by ID and return its metadata (id, display_title, latest_version, timestamps, source).\n- **GET /v1/skills/{skill_id}/versions?beta=true**: Removed GET /v1/skills/{skill_id}/versions?beta=true, a beta endpoint that listed a skill's versions with pagination and returned SkillVersion objects.\n- **POST /v1/skills/{skill_id}/versions?beta=true**: Removed beta endpoint to create a new skill version by uploading files (multipart/form-data); returned a skill_version object.\n- **DELETE /v1/skills/{skill_id}/versions/{version}?beta=true**: Removed beta DELETE endpoint that deleted a specific skill version by skill_id and version (epoch timestamp), returning a skill_version_deleted confirmation.\n- **GET /v1/skills/{skill_id}/versions/{version}?beta=true**: Removed beta GET endpoint to retrieve a specific skill_version by skill_id and version, returning metadata like id, name, directory, description, created_at.\n- **GET /v1/models?beta=true**: Removed beta endpoint GET /v1/models?beta=true that listed available models with pagination and returned ModelInfo objects.\n- **GET /v1/models/{model_id}?beta=true**: Removed beta endpoint to retrieve a specific model by ID or alias, returning ModelInfo.\n- **POST /v1/messages?beta=true**: Removed POST /v1/messages?beta=true — beta Messages API endpoint to create the next assistant message from structured input (text/images, tools, streaming, etc.).\n- **POST /v1/messages/count_tokens?beta=true**: Removed beta endpoint to count tokens in messages/system/tools without creating a Message.\n- **GET /v1/messages/batches?beta=true**: Removed GET /v1/messages/batches?beta=true, which listed Message Batches (beta) with pagination, returning most recent first.\n- **POST /v1/messages/batches?beta=true**: Removed beta-only endpoint to create Message Batches, which allowed submitting multiple Messages API creation requests for bulk processing.\n- **DELETE /v1/messages/batches/{message_batch_id}?beta=true**: Removed endpoint to delete a Message Batch; only deletable after processing finished (in‑progress batches had to be canceled first).\n- **GET /v1/messages/batches/{message_batch_id}?beta=true**: Idempotent endpoint to poll a Message Batch's status and obtain a results_url to download .jsonl results.\n- **GET /v1/messages/batches/{message_batch_id}/results?beta=true**: Removed beta endpoint GET /v1/messages/batches/{message_batch_id}/results?beta=true, which streamed Message Batch results as application/x-jsonl (one result per line; order not guaranteed—use custom_id to match).\n- **POST /v1/messages/batches/{message_batch_id}/cancel?beta=true**: Removed beta endpoint to cancel a Message Batch before processing ended: POST /v1/messages/batches/{message_batch_id}/cancel?beta=true. It returned the updated MessageBatch with processing_status and request_counts.\n- **GET /v1/files?beta=true**: Removed beta List Files route (GET /v1/files?beta=true) that returned a paginated list of file metadata objects.\n- **POST /v1/files?beta=true**: Beta endpoint to upload a file (multipart/form-data) and receive file metadata in response.\n- **DELETE /v1/files/{file_id}?beta=true**: Removed beta endpoint to delete a file by ID (DELETE /v1/files/{file_id}?beta=true); returned a file_deleted object with the deleted file's id.\n- **GET /v1/files/{file_id}?beta=true**: Beta endpoint to retrieve file metadata by ID (id, filename, size_bytes, mime_type) via GET /v1/files/{file_id}?beta=true.\n- **GET /v1/files/{file_id}/content?beta=true**: Removed beta endpoint for downloading file content by ID (application/octet-stream): GET /v1/files/{file_id}/content?beta=true\n\n### New features\n\n- **POST /v1/complete**: Added new model options to request model field\n- **POST /v1/complete**: Added new model options to response model field\n- **POST /v1/complete**: Marked models as deprecated in request: claude-3-5-haiku-latest, claude-3-5-haiku-20241022\n- **POST /v1/complete**: Marked models as deprecated in response: claude-3-5-haiku-latest, claude-3-5-haiku-20241022\n- **GET /v1/files/{file_id}/content?beta=true**: Adds GET /v1/files/{file_id}/content?beta=true to download a file's raw bytes. Returns application/octet-stream on success; accepts file_id path param and optional anthropic-beta and anthropic-version headers; uses x-api-key for auth; 4XX returns a structured error.\n- **DELETE /v1/files/{file_id}?beta=true**: Introduces beta DELETE /v1/files/{file_id}?beta=true to delete a file by ID. Returns a JSON object with the deleted file's id (and type \"file_deleted\") on success; supports standard error responses and optional anthropic-version/anthropic-beta headers.\n- **GET /v1/files/{file_id}?beta=true**: Introduces beta endpoint to retrieve metadata for a file by ID, returning id, filename, mime_type, size_bytes, created_at, and type; supports optional anthropic-beta and anthropic-version headers.\n- **GET /v1/files?beta=true**: Introduces beta GET /v1/files?beta=true to list uploaded files with cursor pagination, returning file metadata and pagination info.\n- **POST /v1/files?beta=true**: Adds beta file upload endpoint POST /v1/files?beta=true that accepts multipart/form-data with a required 'file' field and returns JSON file metadata; supports optional anthropic-beta and anthropic-version headers.\n- **POST /v1/messages**: Added top-level cache_control to apply a cache marker automatically to the last cacheable block\n- **POST /v1/messages**: Added container identifier for reuse across requests\n- **POST /v1/messages**: Added inference_geo to choose geographic region for inference\n- **POST /v1/messages**: Added output_config to control model output (effort, structured output via json_schema)\n- **POST /v1/messages**: Thinking config now supports an additional 'adaptive' mode\n- **POST /v1/messages**: Expanded message content blocks with new tool and container-related types; tool_use/server_tool_use now support optional 'caller'; tool_result content can include tool_reference\n- **POST /v1/messages**: Added 'caller' field to tool_use and server_tool_use request blocks (direct or server-side tool invoker)\n- **POST /v1/messages**: Request tool_result content may now include a tool_reference block\n- **POST /v1/messages**: New server tool result block types: web_fetch_tool_result, code_execution_tool_result, bash_code_execution_tool_result, text_editor_code_execution_tool_result, tool_search_tool_result; plus container_upload content block\n- **POST /v1/messages**: Web search tool result error_code gains 'request_too_large'\n- **POST /v1/messages**: Added web_fetch tool support with new error codes and fetched document block\n- **POST /v1/messages**: Tool definitions expanded: new built-in tools (code_execution variants, memory, web_fetch variants, web_search_20260209, tool_search tools) and new tool-level fields (allowed_callers, defer_loading, strict, input_examples, eager_input_streaming)\n- **POST /v1/messages**: Updated model options: added opus-4-6, sonnet-4-6, opus-4-5 (incl. 20251101); marked several Haiku 3.5 entries deprecated; request example model updated\n- **POST /v1/messages**: Added container field (nullable) in Message response and included it in required list\n- **POST /v1/messages**: Expanded response content blocks to include web_fetch_tool_result, code_execution_tool_result, bash_code_execution_tool_result, text_editor_code_execution_tool_result, tool_search_tool_result, container_upload; added 'caller' to tool_use and server_tool_use responses\n- **POST /v1/messages**: Web search tool result error_code gains 'request_too_large'\n- **POST /v1/messages**: Added web_fetch tool result with fetched document block and error variants\n- **POST /v1/messages**: Usage now includes inference_geo and counts web_fetch_requests in server_tool_use\n- **POST /v1/messages**: Updated response model options and example to new defaults (opus-4-6, sonnet-4-6, etc.)\n- **POST /v1/messages/batches**: Increased maximum number of requests per batch from 10,000 to 100,000.\n- **POST /v1/messages/batches**: Added top-level request cache_control that auto-applies to the last cacheable block.\n- **POST /v1/messages/batches**: Added container parameter to reuse a container across requests.\n- **POST /v1/messages/batches**: Added inference_geo to select geographic region for inference.\n- **POST /v1/messages/batches**: Added output_config to control response format (e.g., JSON schema, effort).\n- **POST /v1/messages/batches**: Added adaptive option to thinking configuration.\n- **POST /v1/messages/batches**: Expanded Messages content block types: added container_upload, web_fetch_tool_result, code_execution_tool_result, bash_code_execution_tool_result, text_editor_code_execution_tool_result, tool_search_tool_result.\n- **POST /v1/messages/batches**: tool_result content can now include tool_reference blocks.\n- **POST /v1/messages/batches**: Added caller field to tool_use blocks to indicate direct vs server-originated invocation.\n- **POST /v1/messages/batches**: Server tool use blocks now include a caller field and support additional tool names (web_fetch, code_execution, bash_code_execution, text_editor_code_execution, tool_search_tool_regex, tool_search_tool_bm25).\n- **POST /v1/messages/batches**: Added new server tool result block types: web_fetch_tool_result, code_execution_tool_result, bash_code_execution_tool_result, text_editor_code_execution_tool_result, tool_search_tool_result (with their result/error shapes).\n- **POST /v1/messages/batches**: Added new error_code value \"request_too_large\" for web_search_tool_result errors.\n- **POST /v1/messages/batches**: Expanded tools: added new built-in tool types (code_execution 20250522/20250825/20260120, memory 20250818, web_fetch 20250910/20260209, web_search 20260209, tool_search_tool_regex/tool_search_tool_bm25 20251119).\n- **POST /v1/messages/batches**: Enhanced tool definitions with optional fields: allowed_callers, defer_loading, strict, input_examples, and for custom tools eager_input_streaming.\n- **POST /v1/messages/batches**: Added new model IDs to params.model: claude-opus-4-6, claude-sonnet-4-6, claude-opus-4-5, claude-opus-4-5-20251101; some older Haiku 3.5 IDs now marked deprecated.\n- **POST /v1/messages/batches/{message_batch_id}/cancel?beta=true**: Adds beta endpoint POST /v1/messages/batches/{message_batch_id}/cancel?beta=true to cancel a Message Batch before processing ends and return the updated MessageBatch status (processing_status, request_counts, timestamps, results_url).\n- **GET /v1/messages/batches/{message_batch_id}/results**: Added Message.container property (nullable) and included it in required fields.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Added 'caller' property to tool_use block and made it required.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Expanded server_tool_use.name from only 'web_search' to multiple tool names.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Added 'caller' property to server_tool_use block and made it required.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Added 'caller' property to web_search_tool_result block and made it required.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Added Usage.inference_geo (nullable string) and included it in required fields.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Added web_fetch_requests to Usage.server_tool_use and included it in required fields.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Added new allowed model IDs: claude-opus-4-6, claude-sonnet-4-6, claude-opus-4-5-20251101, claude-opus-4-5.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Marked models deprecated: claude-3-5-haiku-latest, claude-3-5-haiku-20241022.\n- **GET /v1/messages/batches/{message_batch_id}/results?beta=true**: New endpoint streams Message Batch results as an application/x-jsonl file. Each line is a single request result (succeeded, errored, canceled, or expired). Results may be out of order; use custom_id to match results to requests.\n- **DELETE /v1/messages/batches/{message_batch_id}?beta=true**: Introduces beta DELETE /v1/messages/batches/{message_batch_id}?beta=true to delete a completed Message Batch; in‑progress batches must be canceled first. Successful response returns the batch id and type=message_batch_deleted.\n- **GET /v1/messages/batches/{message_batch_id}?beta=true**: Added GET /v1/messages/batches/{message_batch_id}?beta=true to retrieve a Message Batch. Idempotent; use to poll for completion and obtain processing status, request counts, and a results_url to download .jsonl results.\n- **GET /v1/messages/batches?beta=true**: New beta endpoint to list all Message Batches in a workspace (newest first) with cursor pagination (before_id/after_id, limit). Supports optional anthropic-beta/version headers and x-api-key; returns batch metadata and pagination cursors.\n- **POST /v1/messages/batches?beta=true**: Adds POST /v1/messages/batches?beta=true to create and process a batch of Messages API requests in one call. Returns a message_batch with status, request counts, and a results_url (JSONL) after processing; batches may take up to 24 hours.\n- **POST /v1/messages/count_tokens**: Added top-level cache_control to apply a cache marker to the last cacheable block automatically.\n- **POST /v1/messages/count_tokens**: Added output_config to control output format and effort.\n- **POST /v1/messages/count_tokens**: Added multiple new message content block types: container_upload, web_fetch_tool_result (+ web_fetch_result), code_execution_tool_result, bash_code_execution_tool_result, text_editor_code_execution_tool_result, tool_search_tool_result.\n- **POST /v1/messages/count_tokens**: tool_use content block now supports a caller field (direct or server tool).\n- **POST /v1/messages/count_tokens**: server_tool_use content block now supports a caller field (direct or server tool).\n- **POST /v1/messages/count_tokens**: Expanded server_tool_use.name to support multiple server tools (web_search, web_fetch, code_execution, bash_code_execution, text_editor_code_execution, tool_search_tool_regex, tool_search_tool_bm25).\n- **POST /v1/messages/count_tokens**: tool_result content may now include a tool_reference block.\n- **POST /v1/messages/count_tokens**: web_search_tool_result error_code enum includes new value request_too_large.\n- **POST /v1/messages/count_tokens**: Added web_fetch_tool_result content block with support for either web_fetch_result or web_fetch_tool_result_error.\n- **POST /v1/messages/count_tokens**: Added code_execution_tool_result and bash_code_execution_tool_result content blocks with result and error variants.\n- **POST /v1/messages/count_tokens**: Added text_editor_code_execution_tool_result content block with multiple result and error variants.\n- **POST /v1/messages/count_tokens**: Added tool_search_tool_result content block including tool_search results and errors.\n- **POST /v1/messages/count_tokens**: Added ThinkingConfigAdaptive as a new thinking option.\n- **POST /v1/messages/count_tokens**: Generic custom Tool schema gained allowed_callers, defer_loading, eager_input_streaming, input_examples, strict.\n- **POST /v1/messages/count_tokens**: Added many new tool definitions: CodeExecutionTool_20250522, CodeExecutionTool_20250825, CodeExecutionTool_20260120, MemoryTool_20250818, WebFetchTool_20250910, WebFetchTool_20260209, WebSearchTool_20260209, ToolSearchToolBM25_20251119, ToolSearchToolRegex_20251119.\n- **POST /v1/messages/count_tokens**: Augmented existing tool definitions (e.g., Bash, TextEditor, WebSearch) with allowed_callers, defer_loading, input_examples, and strict properties.\n- **POST /v1/messages/count_tokens**: Added new model options: claude-opus-4-6, claude-sonnet-4-6, claude-opus-4-5-20251101, claude-opus-4-5.\n- **POST /v1/messages/count_tokens?beta=true**: New POST /v1/messages/count_tokens?beta=true endpoint to count tokens for a Message request (including tools, images, and documents) without creating it; returns input_tokens and optional context_management info.\n- **POST /v1/messages?beta=true**: Introduces beta Messages endpoint POST /v1/messages?beta=true to submit structured messages (text/images, tools) and get the next assistant reply with support for streaming, system prompts, extended thinking, and context management.\n- **GET /v1/models/{model_id}?beta=true**: Introduces GET /v1/models/{model_id}?beta=true to retrieve metadata for a specific model or resolve an alias.\n- **GET /v1/models?beta=true**: Introduces GET /v1/models?beta=true to list available models with cursor pagination; newest first.\n- **DELETE /v1/skills/{skill_id}/versions/{version}?beta=true**: New beta DELETE endpoint to remove a specific skill version by skill_id and version (epoch). Returns a confirmation object with id and type=skill_version_deleted.\n- **GET /v1/skills/{skill_id}/versions/{version}?beta=true**: Adds beta GET /v1/skills/{skill_id}/versions/{version}?beta=true to retrieve metadata for a specific skill version (id, name, description, directory, created_at, version, skill_id, type).\n- **GET /v1/skills/{skill_id}/versions?beta=true**: Introduces a beta endpoint GET /v1/skills/{skill_id}/versions to list all versions of a skill. Supports pagination via page token and limit; returns version metadata along with has_more and next_page.\n- **POST /v1/skills/{skill_id}/versions?beta=true**: Introduces beta POST /v1/skills/{skill_id}/versions?beta=true to create a new skill version by uploading a directory (multipart/form-data) with SKILL.md; returns version metadata.\n- **DELETE /v1/skills/{skill_id}?beta=true**: Introduces a beta DELETE endpoint to remove a Skill by ID, returning skill_deleted with id on success.\n- **GET /v1/skills/{skill_id}?beta=true**: Introduces GET /v1/skills/{skill_id}?beta=true to retrieve a skill’s metadata by ID, returning id, display_title, source, latest_version, created_at, and updated_at. Supports optional anthropic-beta and anthropic-version headers and requires API key authentication.\n- **GET /v1/skills?beta=true**: Introduces beta GET /v1/skills to list skills with pagination and optional source filter. Returns skill objects (id, source, titles, timestamps) plus has_more and next_page. Supports anthropic-beta and anthropic-version headers.\n- **POST /v1/skills?beta=true**: Introduces beta POST /v1/skills?beta=true to create a skill via multipart upload (requires SKILL.md) and returns skill metadata (id, display_title, latest_version, source, timestamps).\n\n### Documentation fixes\n\n- **POST /v1/messages**: Updated top-level route description link to docs.claude.com\n- **GET /v1/messages/batches**: Updated user guide link in route description to absolute URL.\n- **POST /v1/messages/batches**: Updated user guide link in operation description to absolute docs URL.\n- **POST /v1/messages/batches**: Updated example model in params example from claude-sonnet-4-5-20250929 to claude-opus-4-6.\n- **DELETE /v1/messages/batches/{message_batch_id}**: Updated user guide link in description to absolute URL.\n- **GET /v1/messages/batches/{message_batch_id}**: Updated user guide link in route description to absolute URL.\n- **POST /v1/messages/batches/{message_batch_id}/cancel**: Updated docs link in route description to absolute URL.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Updated user guide link in description to absolute URL.\n- **GET /v1/messages/batches/{message_batch_id}/results**: Example message model updated in examples (now shows claude-opus-4-6).\n- **POST /v1/messages/count_tokens**: Marked models claude-3-5-haiku-latest and claude-3-5-haiku-20241022 as deprecated.\n- **POST /v1/messages/count_tokens**: Documentation link in description updated to https://docs.claude.com URL.\n- **GET /v1/models**: Updated examples for ModelInfo fields: created_at, display_name, and id.\n- **GET /v1/models/{model_id}**: Updated example values for created_at, display_name, and id in 200 response.\n"}
